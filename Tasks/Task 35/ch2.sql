DO $$
declare type_id int;
val int;
ud record;  -- переменная для строки курсора
begin

if (SELECT count(id) FROM unload_package where id=69)>0 then
update unload_package set end_date='12.12.2018' where id=69;
end if;


if (SELECT count(id) FROM unload_package where id=74)=0 then
  insert into unload_package (id,code,name,description,unload_package_type_id,archive_format,zip_command,unzip_command,start_date) 
  select 74,'M','Пакет информационного обмена с флагами (версия 3.1.5)','Пакет информационного обмена с флагами (версия 3.1.5)',1,'oms','7z a -tzip','7z x  -o','01.01.2018';
end if;

if (SELECT count(id) FROM unload_file where unload_package_id=74 and fl_main)=0 then
insert into unload_file (id,unload_package_id,name,title,version,code,file_type,fl_main,schema_address,code_page,dateformat,start_date) 
select 135,74,'ZL_LIST','Сведения об оказанной медицинской помощи','3.1.5','H','XML',true,'','','','01.01.2018';
end if;

if (SELECT count(id) FROM unload_file where unload_package_id=74 and code='L')=0 then
insert into unload_file (id,unload_package_id,name,title,version,code,file_type,fl_main,schema_address,code_page,dateformat,start_date) 
select 136,74,'PERS_LIST','Файл персональных данных','3.0','L','XML',false,'','','','01.01.2018';
end if;
select setval('ambulance.unload_package_id_seq',(SELECT max(id) FROM unload_package)) into val;
select setval('ambulance.unload_file_id_seq',(SELECT max(id) FROM unload_file)) into val;
select setval('ambulance.unload_data_id_seq',(select max(mm) from (SELECT max(id) as mm FROM unload_data union select 9500 as mm) t)) into val;

FOR ud IN

select 9881 as cd,135 as unload_file_id,1 as order_num,'ZL_LIST' as name,'Корневой элемент' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,1 as column_type,'' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9882 as cd,135 as unload_file_id,2 as order_num,'ZGLV' as name,'Заголовок файла' as description,2 as unload_data_type_id,'8' as length,'' as table_nm,'' as column_nm,1 as column_type,'ZL_LIST' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9883 as cd,135 as unload_file_id,3 as order_num,'SCHET' as name,'Счет' as description,2 as unload_data_type_id,'8' as length,'' as table_nm,'' as column_nm,1 as column_type,'ZL_LIST' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9884 as cd,135 as unload_file_id,4 as order_num,'ZAP' as name,'Записи' as description,2 as unload_data_type_id,'8' as length,'' as table_nm,'' as column_nm,5 as column_type,'ZL_LIST' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9885 as cd,135 as unload_file_id,5 as order_num,'VERSION' as name,'Версия взаимодействия' as description,1 as unload_data_type_id,'5' as length,'unload_file_attr21' as table_nm,'version' as column_nm,3 as column_type,'ZGLV' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9886 as cd,135 as unload_file_id,6 as order_num,'DATA' as name,'Дата формирования' as description,1 as unload_data_type_id,'10' as length,'unload_file_attr21' as table_nm,'data' as column_nm,3 as column_type,'ZGLV' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9887 as cd,135 as unload_file_id,7 as order_num,'FILENAME' as name,'Имя файла' as description,1 as unload_data_type_id,'26' as length,'unload_file_attr21' as table_nm,'filename' as column_nm,3 as column_type,'ZGLV' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9888 as cd,135 as unload_file_id,8 as order_num,'SD_Z' as name,'Количество случаев' as description,2 as unload_data_type_id,'9' as length,'unload_file_attr21' as table_nm,'sd_z' as column_nm,3 as column_type,'ZGLV' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9889 as cd,135 as unload_file_id,9 as order_num,'CODE' as name,'Код записи счета' as description,2 as unload_data_type_id,'8' as length,'unload_file_attr21' as table_nm,'reestr_code' as column_nm,3 as column_type,'SCHET' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9890 as cd,135 as unload_file_id,10 as order_num,'CODE_MO' as name,'Реестровый номер МО' as description,1 as unload_data_type_id,'6' as length,'unload_file_attr21' as table_nm,'code_MO' as column_nm,3 as column_type,'SCHET' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9891 as cd,135 as unload_file_id,11 as order_num,'YEAR' as name,'Отчетный год' as description,2 as unload_data_type_id,'4' as length,'unload_file_attr21' as table_nm,'year' as column_nm,3 as column_type,'SCHET' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9892 as cd,135 as unload_file_id,12 as order_num,'MONTH' as name,'Отчетный месяц' as description,2 as unload_data_type_id,'2' as length,'unload_file_attr21' as table_nm,'month' as column_nm,3 as column_type,'SCHET' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9893 as cd,135 as unload_file_id,13 as order_num,'NSCHET' as name,'Номер счета' as description,1 as unload_data_type_id,'15' as length,'unload_file_attr21' as table_nm,'nschet' as column_nm,3 as column_type,'SCHET' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9894 as cd,135 as unload_file_id,14 as order_num,'DSCHET' as name,'дата выставления счета' as description,1 as unload_data_type_id,'10' as length,'unload_file_attr21' as table_nm,'account_date' as column_nm,3 as column_type,'SCHET' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9895 as cd,135 as unload_file_id,15 as order_num,'PLAT' as name,'Реестровый номер СМО' as description,1 as unload_data_type_id,'5' as length,'unload_file_attr21' as table_nm,'plat_code' as column_nm,4 as column_type,'SCHET' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9896 as cd,135 as unload_file_id,16 as order_num,'SUMMAV' as name,'Сумма выставленная на оплату' as description,2 as unload_data_type_id,'15,2' as length,'unload_file_attr21' as table_nm,'summav' as column_nm,3 as column_type,'SCHET' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9897 as cd,135 as unload_file_id,17 as order_num,'COMENTS' as name,'Служебное поле к счету' as description,1 as unload_data_type_id,'250' as length,'unload_file_attr21' as table_nm,'comments' as column_nm,4 as column_type,'SCHET' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9898 as cd,135 as unload_file_id,18 as order_num,'SUMMAP' as name,'Сумма принятая на оплату' as description,2 as unload_data_type_id,'15,2' as length,'unload_file_attr21' as table_nm,'summap' as column_nm,4 as column_type,'SCHET' as db_table_nm, null as fl_update,'declare @unload_reestr_cd int  select @unload_reestr_cd=ur.cd from journ.dbo.schet s inner join unload_reestr ur on ur.cd=s.reestr_code and ur.finish_date is null update  unload_reestr_account set summap=u.summap, sank_mek=u.sank_mek, sank_mee=u.sank_mee, sank_ekmp=u.sank_ekmp from journ.dbo.SCHET u where unload_reestr_cd=@unload_reestr_cd' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9899 as cd,135 as unload_file_id,19 as order_num,'SANK_MEK' as name,'Сумма, снятая с оплаты после МЭК' as description,2 as unload_data_type_id,'15,2' as length,'unload_file_attr21' as table_nm,'sank_mek' as column_nm,4 as column_type,'SCHET' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9900 as cd,135 as unload_file_id,20 as order_num,'SANK_MEE' as name,'Сумма, снятая с оплаты после МЭЭ' as description,2 as unload_data_type_id,'15,2' as length,'unload_file_attr21' as table_nm,'sank_mee' as column_nm,4 as column_type,'SCHET' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9901 as cd,135 as unload_file_id,21 as order_num,'SANK_EKMP' as name,'Сумма, снятая с оплаты после ЭКМП' as description,2 as unload_data_type_id,'15,2' as length,'unload_file_attr21' as table_nm,'sank_ekmp' as column_nm,4 as column_type,'SCHET' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9902 as cd,135 as unload_file_id,22 as order_num,'DISP' as name,'Тип диспансеризации' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SCHET' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9903 as cd,135 as unload_file_id,23 as order_num,'N_ZAP' as name,'Номер позиции записи' as description,2 as unload_data_type_id,'11' as length,'unload_calls21' as table_nm,'n_zap' as column_nm,3 as column_type,'ZAP' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9904 as cd,135 as unload_file_id,24 as order_num,'PR_NOV' as name,'Признак исправленной записи' as description,2 as unload_data_type_id,'1' as length,'unload_calls21' as table_nm,'pr_nov' as column_nm,3 as column_type,'ZAP' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9905 as cd,135 as unload_file_id,25 as order_num,'PACIENT' as name,'Сведения о пациенте' as description,2 as unload_data_type_id,'11' as length,'' as table_nm,'n_zap' as column_nm,5 as column_type,'ZAP' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9906 as cd,135 as unload_file_id,26 as order_num,'Z_SL' as name,'Сведения о случае' as description,2 as unload_data_type_id,'11' as length,'' as table_nm,'n_zap' as column_nm,5 as column_type,'ZAP' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9907 as cd,135 as unload_file_id,27 as order_num,'ID_PAC' as name,'Код записи о пациенте' as description,1 as unload_data_type_id,'36' as length,'unload_calls21' as table_nm,'PID' as column_nm,3 as column_type,'PACIENT' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9908 as cd,135 as unload_file_id,28 as order_num,'VPOLIS' as name,'Тип полиса' as description,2 as unload_data_type_id,'1' as length,'unload_calls21' as table_nm,'vpolis' as column_nm,3 as column_type,'PACIENT' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9909 as cd,135 as unload_file_id,29 as order_num,'SPOLIS' as name,'Серия полиса' as description,1 as unload_data_type_id,'10' as length,'unload_calls21' as table_nm,'polis_serial' as column_nm,4 as column_type,'PACIENT' as db_table_nm, null as fl_update,'' as update_str,2 as need,'vpolis=1' as check_text,0 as group_teg 
union select 9910 as cd,135 as unload_file_id,30 as order_num,'NPOLIS' as name,'Номер полиса' as description,1 as unload_data_type_id,'20' as length,'unload_calls21' as table_nm,'polis_num' as column_nm,3 as column_type,'PACIENT' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9911 as cd,135 as unload_file_id,31 as order_num,'ST_OKATO' as name,'Регион страхования' as description,1 as unload_data_type_id,'5' as length,'unload_calls21' as table_nm,'st_okato' as column_nm,4 as column_type,'PACIENT' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9912 as cd,135 as unload_file_id,32 as order_num,'SMO' as name,'Реестровый номер СМО' as description,1 as unload_data_type_id,'5' as length,'unload_calls21' as table_nm,'smo_reestr_code' as column_nm,4 as column_type,'PACIENT' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9913 as cd,135 as unload_file_id,33 as order_num,'SMO_OGRN' as name,'ОГРН СМО' as description,1 as unload_data_type_id,'15' as length,'unload_calls21' as table_nm,'smo_ogrn' as column_nm,4 as column_type,'PACIENT' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9914 as cd,135 as unload_file_id,34 as order_num,'SMO_OK' as name,'ОКАТО страхования' as description,1 as unload_data_type_id,'5' as length,'unload_calls21' as table_nm,'smo_okato' as column_nm,4 as column_type,'PACIENT' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9915 as cd,135 as unload_file_id,35 as order_num,'SMO_NAM' as name,'Наименование СМО' as description,1 as unload_data_type_id,'100' as length,'unload_calls21' as table_nm,'smo_name' as column_nm,4 as column_type,'PACIENT' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9916 as cd,135 as unload_file_id,36 as order_num,'NOVOR' as name,'Признак новорожденного' as description,1 as unload_data_type_id,'9' as length,'unload_calls21' as table_nm,'przn_novor' as column_nm,3 as column_type,'PACIENT' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9917 as cd,135 as unload_file_id,37 as order_num,'SOC_STATUS' as name,'Социальный статус' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'PACIENT' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9918 as cd,135 as unload_file_id,38 as order_num,'CAT_LGOT' as name,'Категория льгот' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'PACIENT' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9919 as cd,135 as unload_file_id,39 as order_num,'VNOV_D' as name,'Вес при рождении' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'PACIENT' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9920 as cd,135 as unload_file_id,40 as order_num,'IDCASE' as name,'Номер записи' as description,2 as unload_data_type_id,'11' as length,'unload_calls21' as table_nm,'n_zap' as column_nm,3 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9921 as cd,135 as unload_file_id,41 as order_num,'USL_OK' as name,'Условия оказания медицинской помощи' as description,2 as unload_data_type_id,'2' as length,'unload_calls21' as table_nm,'usl_ok' as column_nm,3 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9922 as cd,135 as unload_file_id,42 as order_num,'VIDPOM' as name,'Вид помощи' as description,2 as unload_data_type_id,'4' as length,'unload_calls21' as table_nm,'vid_pom' as column_nm,3 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9923 as cd,135 as unload_file_id,43 as order_num,'FOR_POM' as name,'Форма оказания медицинской помощи' as description,2 as unload_data_type_id,'1' as length,'unload_calls21' as table_nm,'for_pom' as column_nm,3 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9924 as cd,135 as unload_file_id,44 as order_num,'NPR_MO' as name,'Код МО, направившего на лечение' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9925 as cd,135 as unload_file_id,45 as order_num,'EXTR' as name,'Направление (госпитализация)' as description,2 as unload_data_type_id,'2' as length,'unload_calls21' as table_nm,'extr' as column_nm,4 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9926 as cd,135 as unload_file_id,46 as order_num,'LPU' as name,'Код МО' as description,1 as unload_data_type_id,'6' as length,'unload_calls21' as table_nm,'LPU_code' as column_nm,3 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9927 as cd,135 as unload_file_id,47 as order_num,'MCOD' as name,'МО прикрепления по срезу' as description,1 as unload_data_type_id,'6' as length,'' as table_nm,'' as column_nm,null as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9928 as cd,135 as unload_file_id,48 as order_num,'VBR' as name,'Признак мобильной медицинской бригады при диспансеризации' as description,2 as unload_data_type_id,'1' as length,'' as table_nm,'' as column_nm,null as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9929 as cd,135 as unload_file_id,49 as order_num,'DATE_Z_1' as name,'Дата начала лечения' as description,1 as unload_data_type_id,'10' as length,'unload_calls21' as table_nm,'date_s' as column_nm,3 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9930 as cd,135 as unload_file_id,50 as order_num,'DATE_Z_2' as name,'Дата окончания лечения' as description,1 as unload_data_type_id,'10' as length,'unload_calls21' as table_nm,'date_f' as column_nm,3 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9931 as cd,135 as unload_file_id,51 as order_num,'P_OTK' as name,'Признак отказа от диспансеризации' as description,2 as unload_data_type_id,'1' as length,'unload_calls21' as table_nm,'P_OTK' as column_nm,3 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9932 as cd,135 as unload_file_id,52 as order_num,'VNOV_M' as name,'Вес при рождении' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9933 as cd,135 as unload_file_id,53 as order_num,'RSLT' as name,'Результат обращения' as description,2 as unload_data_type_id,'3' as length,'unload_calls21' as table_nm,'call_result' as column_nm,3 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9934 as cd,135 as unload_file_id,54 as order_num,'RSLT_D' as name,'Результат диспансеризации' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9935 as cd,135 as unload_file_id,55 as order_num,'ISHOD' as name,'Исход заболевания' as description,2 as unload_data_type_id,'3' as length,'unload_calls21' as table_nm,'measure_code' as column_nm,3 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9936 as cd,135 as unload_file_id,56 as order_num,'OS_SLUCH' as name,'Особый случай' as description,2 as unload_data_type_id,'11' as length,'' as table_nm,'n_zap' as column_nm,5 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9937 as cd,135 as unload_file_id,57 as order_num,'OS_SLUCH' as name,'Признак особый случай' as description,2 as unload_data_type_id,'1' as length,'unload_special_case' as table_nm,'OS_SLUCH_CODE' as column_nm,4 as column_type,'OS_SLUCH' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9938 as cd,135 as unload_file_id,58 as order_num,'SL' as name,'Сведения о случае' as description,2 as unload_data_type_id,'11' as length,'' as table_nm,'n_zap' as column_nm,5 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9939 as cd,135 as unload_file_id,59 as order_num,'SL_ID' as name,'Идентификатор' as description,1 as unload_data_type_id,'36' as length,'unload_calls21' as table_nm,'IDSERV' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9940 as cd,135 as unload_file_id,60 as order_num,'MSGUID' as name,'Уникальный идентификационный номер случая' as description,1 as unload_data_type_id,'36' as length,'unload_calls21' as table_nm,'UID' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9941 as cd,135 as unload_file_id,61 as order_num,'IDSP' as name,'Код способа оплаты' as description,2 as unload_data_type_id,'2' as length,'unload_calls21' as table_nm,'idsp' as column_nm,3 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9942 as cd,135 as unload_file_id,62 as order_num,'SUMV' as name,'Сумма на оплату' as description,2 as unload_data_type_id,'15,2' as length,'unload_calls21' as table_nm,'sumv' as column_nm,3 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9943 as cd,135 as unload_file_id,63 as order_num,'OPLATA' as name,'Тип оплаты' as description,2 as unload_data_type_id,'1' as length,'unload_calls21' as table_nm,'oplata' as column_nm,4 as column_type,'Z_SL' as db_table_nm, null as fl_update,'declare @unload_reestr_cd int select @unload_reestr_cd=ur.cd from journ.dbo.schet s inner join unload_reestr ur on ur.cd=s.reestr_code and ur.finish_date is null update unload_reestr_callsp set oplata=Z_SL.oplata from journ.dbo.Z_SL Z_SL left join journ.dbo.sl sl on Z_SL.n_zap=sl.n_zap left join patient_callsp pc on pc.UID=sl.UID collate Cyrillic_General_CI_AS where unload_reestr_cd=@unload_reestr_cd and unload_reestr_callsp.callsp_cd=pc.callsp_cd and Z_SL.oplata is not null' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9944 as cd,135 as unload_file_id,64 as order_num,'SUMP' as name,'Сумма принятая на оплату' as description,2 as unload_data_type_id,'15,2' as length,'unload_calls21' as table_nm,'sump' as column_nm,4 as column_type,'Z_SL' as db_table_nm, null as fl_update,'declare @unload_reestr_cd int  select @unload_reestr_cd=ur.cd from journ.dbo.schet s inner join unload_reestr ur on ur.cd=s.reestr_code and ur.finish_date is null update unload_reestr_callsp set sump=Z_SL.sump from  journ.dbo.Z_SL Z_SL left join journ.dbo.sl sl on Z_SL.n_zap=sl.n_zap left join patient_callsp pc on pc.UID=sl.UID collate Cyrillic_General_CI_AS where unload_reestr_cd=@unload_reestr_cd and unload_reestr_callsp.callsp_cd=pc.callsp_cd and Z_SL.sump is not null' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9945 as cd,135 as unload_file_id,65 as order_num,'SANK' as name,'Сведения о санкциях' as description,2 as unload_data_type_id,'11' as length,'' as table_nm,'n_zap' as column_nm,5 as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9946 as cd,135 as unload_file_id,66 as order_num,'SANK_IT' as name,'Сумма санкций по случаю' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'Z_SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9947 as cd,135 as unload_file_id,67 as order_num,'VID_HMP' as name,'Вид высокотехнологичной мед. помощи' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9948 as cd,135 as unload_file_id,68 as order_num,'METOD_HMP' as name,'Метод высокотехнологичной помощи' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9949 as cd,135 as unload_file_id,69 as order_num,'LPU_1' as name,'Подразделение МО' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9950 as cd,135 as unload_file_id,70 as order_num,'PODR' as name,'Код отделения' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9951 as cd,135 as unload_file_id,71 as order_num,'PROFIL_TS' as name,'Профиль в соответствии с тарифным соглашением' as description,2 as unload_data_type_id,'3' as length,'unload_calls21' as table_nm,'PROFIL_TS' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9952 as cd,135 as unload_file_id,72 as order_num,'PROFIL' as name,'Профиль оказанной помощи' as description,2 as unload_data_type_id,'3' as length,'unload_calls21' as table_nm,'profil' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9953 as cd,135 as unload_file_id,73 as order_num,'DET' as name,'Признак детского профиля' as description,2 as unload_data_type_id,'1' as length,'unload_calls21' as table_nm,'det_przn' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9954 as cd,135 as unload_file_id,74 as order_num,'C_AMB' as name,'Цель посещения амбулаторной медицинской помощи' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9955 as cd,135 as unload_file_id,75 as order_num,'NHISTORY' as name,'Номер талона' as description,1 as unload_data_type_id,'50' as length,'unload_calls21' as table_nm,'kt_num' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9956 as cd,135 as unload_file_id,76 as order_num,'DATE_1' as name,'Дата начала лечения' as description,1 as unload_data_type_id,'10' as length,'unload_calls21' as table_nm,'date_s' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9957 as cd,135 as unload_file_id,77 as order_num,'DATE_2' as name,'Дата окончания лечения' as description,1 as unload_data_type_id,'10' as length,'unload_calls21' as table_nm,'date_f' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9958 as cd,135 as unload_file_id,78 as order_num,'DS1' as name,'Диагноз основной' as description,1 as unload_data_type_id,'10' as length,'unload_calls21' as table_nm,'diag_mkb1' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9959 as cd,135 as unload_file_id,79 as order_num,'DS3' as name,'Диагноз осложнения' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9960 as cd,135 as unload_file_id,80 as order_num,'DS_ONK' as name,'Признак подозрения на злокачественное новообразование' as description,2 as unload_data_type_id,'1' as length,'unload_calls21' as table_nm,'ds_onk' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9961 as cd,135 as unload_file_id,81 as order_num,'CODE_MES1' as name,'Код МЭС' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9962 as cd,135 as unload_file_id,82 as order_num,'CODE_MES2' as name,'Код МЭС сопутствующего заболевания' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9963 as cd,135 as unload_file_id,83 as order_num,'CONS' as name,'Сведения о проведении консилиума' as description,2 as unload_data_type_id,'11' as length,'' as table_nm,'n_zap' as column_nm,5 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9964 as cd,135 as unload_file_id,84 as order_num,'PR_CONS' as name,'Цель проведения консилиума' as description,2 as unload_data_type_id,'1' as length,'' as table_nm,'PR_CONS' as column_nm,4 as column_type,'CONS' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9965 as cd,135 as unload_file_id,85 as order_num,'KSG_KPG' as name,'Сведения о КСГ/КПГ' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9966 as cd,135 as unload_file_id,86 as order_num,'PRVS' as name,'Специальность лечащего врача' as description,2 as unload_data_type_id,'9' as length,'unload_calls21' as table_nm,'emp_spec_code' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9967 as cd,135 as unload_file_id,87 as order_num,'VERS_SPEC' as name,'Код классификатора медицинских специальностей' as description,1 as unload_data_type_id,'4' as length,'unload_calls21' as table_nm,'vers_spec' as column_nm,4 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9968 as cd,135 as unload_file_id,88 as order_num,'IDDOKT' as name,'Код врача закрывшего талон' as description,1 as unload_data_type_id,'25' as length,'unload_calls21' as table_nm,'emp_code' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9969 as cd,135 as unload_file_id,89 as order_num,'ED_COL' as name,'Количество единиц оплаты МП' as description,2 as unload_data_type_id,'5,2' as length,'unload_calls21' as table_nm,'ED_COL' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9970 as cd,135 as unload_file_id,90 as order_num,'TARIF' as name,'Тариф' as description,2 as unload_data_type_id,'15,2' as length,'unload_calls21' as table_nm,'TARIF' as column_nm,4 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9971 as cd,135 as unload_file_id,91 as order_num,'TARIF_BAS' as name,'Сумма к оплате по базовому тарифу' as description,2 as unload_data_type_id,'15,2' as length,'unload_calls21' as table_nm,'TARIF_BAS' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9972 as cd,135 as unload_file_id,92 as order_num,'SUM_M' as name,'Стоимость случая, выставленная к оплате' as description,2 as unload_data_type_id,'15,2' as length,'unload_calls21' as table_nm,'sumv' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9973 as cd,135 as unload_file_id,93 as order_num,'USL' as name,'Сведения об услуге' as description,2 as unload_data_type_id,'11' as length,'' as table_nm,'n_zap' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9974 as cd,135 as unload_file_id,94 as order_num,'MP_PO' as name,'Оказание МП в приемном отделении' as description,2 as unload_data_type_id,'1' as length,'unload_calls21' as table_nm,'MP_PO' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9975 as cd,135 as unload_file_id,95 as order_num,'COD_LEVEL' as name,'Уровень оказания медицинской помощи' as description,2 as unload_data_type_id,'1' as length,'unload_calls21' as table_nm,'COD_LEVEL' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9976 as cd,135 as unload_file_id,96 as order_num,'COD_LVL' as name,'Подуровень оказания медицинской помощи' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9977 as cd,135 as unload_file_id,97 as order_num,'FL' as name,'Флаги' as description,1 as unload_data_type_id,'30' as length,'unload_calls21' as table_nm,'fl' as column_nm,4 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9978 as cd,135 as unload_file_id,98 as order_num,'COD_VD' as name,'Код врачебной должности' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9979 as cd,135 as unload_file_id,99 as order_num,'COD_ZS' as name,'Код законченного случая' as description,1 as unload_data_type_id,'3' as length,'unload_calls21' as table_nm,'COD_ZS' as column_nm,3 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9980 as cd,135 as unload_file_id,100 as order_num,'V_SMP' as name,'Виды бригад скорой медицинской помощи' as description,2 as unload_data_type_id,'2' as length,'unload_calls21' as table_nm,'brg_type_code' as column_nm,4 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9981 as cd,135 as unload_file_id,101 as order_num,'TROMB' as name,'Проведение тромболизиса' as description,2 as unload_data_type_id,'1' as length,'unload_calls21' as table_nm,'TROMB' as column_nm,4 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9982 as cd,135 as unload_file_id,102 as order_num,'CALL_TYPE' as name,'Вид вызова для СМП' as description,2 as unload_data_type_id,'1' as length,'unload_calls21' as table_nm,'CALL_TYPE' as column_nm,4 as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9983 as cd,135 as unload_file_id,103 as order_num,'CODE_MO_DOG' as name,'Код МО на предоставление мед.услуг' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9984 as cd,135 as unload_file_id,104 as order_num,'LP' as name,'Сведения о примененных лекарственных препаратах' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9985 as cd,135 as unload_file_id,105 as order_num,'RSLT_DISP' as name,'Результат диспансеризации' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9986 as cd,135 as unload_file_id,106 as order_num,'GR_HEALTH' as name,'Группа здоровья' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9987 as cd,135 as unload_file_id,107 as order_num,'COMENTSL' as name,'Служебное поле' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9988 as cd,135 as unload_file_id,108 as order_num,'S_CODE' as name,'Идентификатор санкции' as description,1 as unload_data_type_id,'36' as length,'unload_calls21' as table_nm,'' as column_nm,null as column_type,'SANK' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9989 as cd,135 as unload_file_id,109 as order_num,'S_SUM' as name,'Финансовая санкция' as description,2 as unload_data_type_id,'15,2' as length,'unload_calls21' as table_nm,'S_SUM' as column_nm,null as column_type,'SANK' as db_table_nm, null as fl_update,'declare @unload_reestr_cd int  select @unload_reestr_cd=ur.cd from journ.dbo.schet s inner join unload_reestr ur on ur.cd=s.reestr_code and ur.finish_date is null delete reestr_refreason where unload_reestr_callsp_cd in (select cd from unload_reestr_callsp where unload_reestr_cd=@unload_reestr_cd) insert into reestr_refreason(unload_reestr_callsp_cd, refreason_cd, sank_type, sank_sum, message) select urc.cd,r.cd,s.S_TIP,s.S_SUM, s.S_COM collate Cyrillic_General_CI_AS  from  journ.dbo.sank s left join refreason r on r.code=s.S_OSN and r.finish_date is null left join journ.dbo.sl sl on s.n_zap=sl.n_zap left join patient_callsp pc on pc.UID=sl.UID collate Cyrillic_General_CI_AS inner join unload_reestr_callsp urc on urc.callsp_cd=pc.callsp_cd and urc.unload_reestr_cd=@unload_reestr_cd where isnull(s.S_SUM,0)<>0  declare upd_c cursor static for select callsp_cd from unload_reestr_callsp urc where unload_reestr_cd=@unload_reestr_cd and callsp_cd in (select urc.callsp_cd from reestr_refreason r left join unload_reestr_callsp urc on r.unload_reestr_callsp_cd=urc.cd where urc.unload_reestr_cd=@unload_reestr_cd and isnull(r.sank_sum,0)<>0)  declare @cd int open upd_c fetch from upd_c into @cd while @@fetch_status=0 begin   update unload_reestr_callsp set sank_mek=(select min(t.sumv) from (select isnull(sum(r.sank_sum),0) as sumv from reestr_refreason r where r.unload_reestr_callsp_cd in (select cd from unload_reestr_callsp where callsp_cd=@cd and unload_reestr_cd=@unload_reestr_cd) and r.sank_type=1 and isnull(r.sank_sum,0)<>0 union select isnull(sl.sumv,0) as sumv from journ.dbo.sl sl left join patient_callsp pc on pc.UID=sl.UID collate Cyrillic_General_CI_AS and pc.callsp_cd=@cd and sl.sumv is not null ) as t) where unload_reestr_cd=@unload_reestr_cd and callsp_cd=@cd  update unload_reestr_callsp set sank_mee=(select min(t.sumv) from (select isnull(sum(r.sank_sum),0) as sumv from reestr_refreason r where r.unload_reestr_callsp_cd in (select cd from unload_reestr_callsp where callsp_cd=@cd and unload_reestr_cd=@unload_reestr_cd) and r.sank_type=2 and isnull(r.sank_sum,0)<>0 union select isnull(sl.sumv,0) as sumv from journ.dbo.sl sl left join patient_callsp pc on pc.UID=sl.UID collate Cyrillic_General_CI_AS and pc.callsp_cd=@cd and sl.sumv is not null ) as t) where unload_reestr_cd=@unload_reestr_cd and callsp_cd=@cd  update unload_reestr_callsp set sank_ekmp=(select min(t.sumv) from (select isnull(sum(r.sank_sum),0) as sumv from reestr_refreason r where r.unload_reestr_callsp_cd in (select cd from unload_reestr_callsp where callsp_cd=@cd and unload_reestr_cd=@unload_reestr_cd) and r.sank_type=3 and isnull(r.sank_sum,0)<>0 union select isnull(sl.sumv,0) as sumv from journ.dbo.sl sl left join patient_callsp pc on pc.UID=sl.UID collate Cyrillic_General_CI_AS and pc.callsp_cd=@cd and sl.sumv is not null ) as t) where unload_reestr_cd=@unload_reestr_cd and callsp_cd=@cd  fetch from upd_c into @cd end close upd_c deallocate upd_c' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9990 as cd,135 as unload_file_id,110 as order_num,'S_TIP' as name,'Тип санкции' as description,2 as unload_data_type_id,'2' as length,'unload_calls21' as table_nm,'S_TIP' as column_nm,null as column_type,'SANK' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9991 as cd,135 as unload_file_id,111 as order_num,'SL_ID' as name,'Идентификатор случая' as description,1 as unload_data_type_id,'36' as length,'unload_calls21' as table_nm,'SL_ID' as column_nm,null as column_type,'SANK' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9992 as cd,135 as unload_file_id,112 as order_num,'S_OSN' as name,'Код причины отказа оплаты' as description,2 as unload_data_type_id,'3' as length,'unload_calls21' as table_nm,'S_OSN' as column_nm,null as column_type,'SANK' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9993 as cd,135 as unload_file_id,113 as order_num,'DATE_ACT' as name,'Дата акта' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SANK' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9994 as cd,135 as unload_file_id,114 as order_num,'NUM_ACT' as name,'Номер акта' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SANK' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9995 as cd,135 as unload_file_id,115 as order_num,'CODE_EXP' as name,'Код эксперта качества медицинской помощи' as description,1 as unload_data_type_id,'8' as length,'' as table_nm,'' as column_nm,null as column_type,'SANK' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 9996 as cd,135 as unload_file_id,116 as order_num,'S_COM' as name,'Комментарий' as description,1 as unload_data_type_id,'250' as length,'unload_calls21' as table_nm,'S_COM' as column_nm,null as column_type,'SANK' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9997 as cd,135 as unload_file_id,117 as order_num,'S_IST' as name,'Источник' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'SANK' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 9998 as cd,135 as unload_file_id,118 as order_num,'IDSERV' as name,'Номер записи в реестре услуг' as description,1 as unload_data_type_id,'36' as length,'unload_calls21' as table_nm,'IDSERV' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 9999 as cd,135 as unload_file_id,119 as order_num,'LPU' as name,'Код МО' as description,1 as unload_data_type_id,'6' as length,'unload_calls21' as table_nm,'LPU_code' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10000 as cd,135 as unload_file_id,120 as order_num,'LPU_1' as name,'Подразделение МО' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 10001 as cd,135 as unload_file_id,121 as order_num,'PODR' as name,'Код отделения' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 10002 as cd,135 as unload_file_id,122 as order_num,'PROFIL_TS' as name,'Профиль в соответствии с тарифным соглашением' as description,2 as unload_data_type_id,'3' as length,'unload_calls21' as table_nm,'PROFIL_TS' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10003 as cd,135 as unload_file_id,123 as order_num,'PROFIL' as name,'Профиль' as description,2 as unload_data_type_id,'3' as length,'unload_calls21' as table_nm,'PROFIL' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10004 as cd,135 as unload_file_id,124 as order_num,'VID_VME' as name,'Вид медицинского вмешательства' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 10005 as cd,135 as unload_file_id,125 as order_num,'DET' as name,'Признак детского профиля' as description,2 as unload_data_type_id,'1' as length,'unload_calls21' as table_nm,'det_przn' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10006 as cd,135 as unload_file_id,126 as order_num,'DATE_IN' as name,'Дата начала оказания услуги' as description,1 as unload_data_type_id,'10' as length,'unload_calls21' as table_nm,'date_s' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10007 as cd,135 as unload_file_id,127 as order_num,'DATE_OUT' as name,'Дата окончания оказания услуги' as description,1 as unload_data_type_id,'10' as length,'unload_calls21' as table_nm,'date_f' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10008 as cd,135 as unload_file_id,128 as order_num,'DS' as name,'Диагноз' as description,1 as unload_data_type_id,'10' as length,'unload_calls21' as table_nm,'diag_mkb1' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10009 as cd,135 as unload_file_id,129 as order_num,'CODE_USL' as name,'Код услуги' as description,1 as unload_data_type_id,'20' as length,'unload_calls21' as table_nm,'tarif_code' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10010 as cd,135 as unload_file_id,130 as order_num,'KOL_USL' as name,'Количество услуг (кратность услуги)' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 10011 as cd,135 as unload_file_id,131 as order_num,'TARIF' as name,'Тариф' as description,2 as unload_data_type_id,'15,2' as length,'unload_calls21' as table_nm,'tarif' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 10012 as cd,135 as unload_file_id,132 as order_num,'SUMV_USL' as name,'Стоимость медицинской услуги, принятая к оплате (руб.)' as description,2 as unload_data_type_id,'15,2' as length,'unload_calls21' as table_nm,'sumv' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 10013 as cd,135 as unload_file_id,133 as order_num,'PRVS' as name,'Специальность медработника, выполнившего услугу' as description,2 as unload_data_type_id,'9' as length,'unload_calls21' as table_nm,'emp_spec_code' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10014 as cd,135 as unload_file_id,134 as order_num,'CODE_MD' as name,'Код медицинского работника, оказавшего медицинскую услугу' as description,1 as unload_data_type_id,'16' as length,'unload_calls21' as table_nm,'emp_code' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10015 as cd,135 as unload_file_id,135 as order_num,'COMENTU' as name,'Служебное поле' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'USL' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
    LOOP
       if (select count(*) from unload_data where unload_file_id=135 and name=ud.name and db_table_nm=ud.db_table_nm)=0 then
	insert into unload_data (id,unload_file_id,order_num,name,description,unload_data_type_id,length,table_nm,column_nm,unload_column_type_id,db_table_nm,fl_update,update_str,need,check_text,group_teg,fl_const,start_date)
	select ud.cd,ud.unload_file_id,ud.order_num,ud.name,ud.description,ud.unload_data_type_id,ud.length,ud.table_nm,ud.column_nm,ud.column_type,ud.db_table_nm,case when ud.fl_update is null then false else true end,ud.update_str,
	case when ud.need=1 then true when ud.need=3 then false else null end,ud.check_text,ud.group_teg,false,'01.01.2018';
       end if;
    END LOOP;

FOR ud IN
select 10016 as cd,136 as unload_file_id,1 as order_num,'PERS_LIST' as name,'Корневой элемент' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,1 as column_type,'' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 10017 as cd,136 as unload_file_id,2 as order_num,'ZGLV' as name,'Заголовок файла' as description,2 as unload_data_type_id,'8' as length,'' as table_nm,'' as column_nm,1 as column_type,'PERS_LIST' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10018 as cd,136 as unload_file_id,3 as order_num,'PERS' as name,'Данные' as description,2 as unload_data_type_id,'8' as length,'' as table_nm,'' as column_nm,5 as column_type,'PERS_LIST' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10019 as cd,136 as unload_file_id,4 as order_num,'VERSION' as name,'Версия взаимодействия' as description,1 as unload_data_type_id,'5' as length,'unload_file_attr21' as table_nm,'version' as column_nm,3 as column_type,'ZGLV' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10020 as cd,136 as unload_file_id,5 as order_num,'DATA' as name,'Дата' as description,1 as unload_data_type_id,'10' as length,'unload_file_attr21' as table_nm,'data' as column_nm,3 as column_type,'ZGLV' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10021 as cd,136 as unload_file_id,6 as order_num,'FILENAME' as name,'Имя файла' as description,1 as unload_data_type_id,'26' as length,'unload_file_attr21' as table_nm,'filename' as column_nm,3 as column_type,'ZGLV' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10022 as cd,136 as unload_file_id,7 as order_num,'FILENAME1' as name,'Имя основного файла' as description,1 as unload_data_type_id,'26' as length,'unload_file_attr21' as table_nm,'filename1' as column_nm,3 as column_type,'ZGLV' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10023 as cd,136 as unload_file_id,8 as order_num,'ID_PAC' as name,'Код записи о пациенте' as description,1 as unload_data_type_id,'36' as length,'unload_PID21' as table_nm,'PID' as column_nm,3 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,2 as group_teg 
union select 10024 as cd,136 as unload_file_id,9 as order_num,'FAM' as name,'Фамилия пациента' as description,1 as unload_data_type_id,'40' as length,'unload_PID21' as table_nm,'FAM' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'fl_patient_represent=0' as check_text,0 as group_teg 
union select 10025 as cd,136 as unload_file_id,10 as order_num,'IM' as name,'Имя пациента' as description,1 as unload_data_type_id,'40' as length,'unload_PID21' as table_nm,'IM' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'fl_patient_represent=0' as check_text,0 as group_teg 
union select 10026 as cd,136 as unload_file_id,11 as order_num,'OT' as name,'Отчество пациента' as description,1 as unload_data_type_id,'40' as length,'unload_PID21' as table_nm,'OT' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'isnull(fl_patient_represent,0)=0 and sc_code2 is null' as check_text,0 as group_teg 
union select 10027 as cd,136 as unload_file_id,12 as order_num,'W' as name,'Пол пациента' as description,2 as unload_data_type_id,'1' as length,'unload_PID21' as table_nm,'sex_code' as column_nm,3 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10028 as cd,136 as unload_file_id,13 as order_num,'DR' as name,'Дата рождения пациента' as description,1 as unload_data_type_id,'10' as length,'unload_PID21' as table_nm,'DR' as column_nm,3 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10029 as cd,136 as unload_file_id,14 as order_num,'DOST' as name,'Надежность идентификации' as description,1 as unload_data_type_id,'36' as length,'' as table_nm,'PID' as column_nm,5 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 10030 as cd,136 as unload_file_id,15 as order_num,'DOST' as name,'Код надежности идентификации' as description,2 as unload_data_type_id,'1' as length,'unload_special_case' as table_nm,'DOST_CODE' as column_nm,4 as column_type,'DOST' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 10031 as cd,136 as unload_file_id,16 as order_num,'FAM_P' as name,'Фамилия представителя' as description,1 as unload_data_type_id,'40' as length,'unload_PID21' as table_nm,'FAM_P' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'fl_patient_represent=1' as check_text,0 as group_teg 
union select 10032 as cd,136 as unload_file_id,17 as order_num,'IM_P' as name,'Имя представителя' as description,1 as unload_data_type_id,'40' as length,'unload_PID21' as table_nm,'IM_P' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'fl_patient_represent=1' as check_text,0 as group_teg 
union select 10033 as cd,136 as unload_file_id,18 as order_num,'OT_P' as name,'Отчество представителя' as description,1 as unload_data_type_id,'40' as length,'unload_PID21' as table_nm,'OT_P' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'fl_patient_represent=1 and sc_code2 is null' as check_text,0 as group_teg 
union select 10034 as cd,136 as unload_file_id,19 as order_num,'W_P' as name,'Пол представителя' as description,2 as unload_data_type_id,'1' as length,'unload_PID21' as table_nm,'sex_code_P' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'fl_patient_represent=1' as check_text,0 as group_teg 
union select 10035 as cd,136 as unload_file_id,20 as order_num,'DR_P' as name,'Дата рождения представителя' as description,1 as unload_data_type_id,'10' as length,'unload_PID21' as table_nm,'DR_P' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'fl_patient_represent=1' as check_text,0 as group_teg 
union select 10036 as cd,136 as unload_file_id,21 as order_num,'DOST_P' as name,'Надежность идентификации представителя' as description,1 as unload_data_type_id,'36' as length,'' as table_nm,'PID' as column_nm,5 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 10037 as cd,136 as unload_file_id,22 as order_num,'DOST_P' as name,'Код надежности идентификации' as description,2 as unload_data_type_id,'1' as length,'unload_special_case' as table_nm,'DOST_P_CODE' as column_nm,4 as column_type,'DOST_P' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 10038 as cd,136 as unload_file_id,23 as order_num,'MR' as name,'Место рождения пациента или представителя' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 10039 as cd,136 as unload_file_id,24 as order_num,'DOCTYPE' as name,'Тип документа' as description,1 as unload_data_type_id,'2' as length,'unload_PID21' as table_nm,'doctype' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'vpolis<>3 and smo_reestr_code collate Cyrillic_General_CI_AS not in (select smo.reestr_code collate Cyrillic_General_CI_AS from smo,smo_ord where smo.cd=smo_ord.smo_cd)' as check_text,0 as group_teg 
union select 10040 as cd,136 as unload_file_id,25 as order_num,'DOCSER' as name,'Серия документа' as description,1 as unload_data_type_id,'10' as length,'unload_PID21' as table_nm,'docser' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'vpolis<>3 and smo_reestr_code collate Cyrillic_General_CI_AS not in (select smo.reestr_code collate Cyrillic_General_CI_AS from smo,smo_ord where smo.cd=smo_ord.smo_cd)' as check_text,0 as group_teg 
union select 10041 as cd,136 as unload_file_id,26 as order_num,'DOCNUM' as name,'Номер документа' as description,1 as unload_data_type_id,'20' as length,'unload_PID21' as table_nm,'docnum' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'vpolis<>3 and smo_reestr_code collate Cyrillic_General_CI_AS not in (select smo.reestr_code collate Cyrillic_General_CI_AS from smo,smo_ord where smo.cd=smo_ord.smo_cd)' as check_text,0 as group_teg 
union select 10042 as cd,136 as unload_file_id,27 as order_num,'SNILS' as name,'СНИЛС' as description,1 as unload_data_type_id,'14' as length,'unload_PID21' as table_nm,'snils' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 10043 as cd,136 as unload_file_id,28 as order_num,'ENP' as name,'ЕНП' as description,1 as unload_data_type_id,'16' as length,'unload_PID21' as table_nm,'enp' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 10044 as cd,136 as unload_file_id,29 as order_num,'OKATOG' as name,'Код места жительства' as description,1 as unload_data_type_id,'11' as length,'unload_PID21' as table_nm,'okatog' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 10045 as cd,136 as unload_file_id,30 as order_num,'OKATOP' as name,'Код места пребывания по ОКАТО' as description,1 as unload_data_type_id,'11' as length,'unload_PID21' as table_nm,'okatop' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 10046 as cd,136 as unload_file_id,31 as order_num,'GR_P' as name,'Гражданство пациента' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
union select 10047 as cd,136 as unload_file_id,32 as order_num,'KLADR_PASP' as name,'Адрес регистрации (КЛАДР)' as description,1 as unload_data_type_id,'15' as length,'unload_PID21' as table_nm,'KLADR_PASP' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 10048 as cd,136 as unload_file_id,33 as order_num,'ADR_PASP' as name,'Адрес регистрации в формате ''9 запятых''' as description,1 as unload_data_type_id,'250' as length,'unload_PID21' as table_nm,'home_addr' as column_nm,3 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10049 as cd,136 as unload_file_id,34 as order_num,'KLADR_FACT' as name,'Адрес по месту жительства (КЛАДР)' as description,1 as unload_data_type_id,'15' as length,'unload_PID21' as table_nm,'KLADR_FACT' as column_nm,4 as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,2 as need,'' as check_text,0 as group_teg 
union select 10050 as cd,136 as unload_file_id,35 as order_num,'ADR_FACT' as name,'Адрес по месту жительства в формате ''9 запятых''' as description,1 as unload_data_type_id,'250' as length,'unload_PID21' as table_nm,'fact_home_addr' as column_nm,3 as column_type,'PERS' as db_table_nm, null as fl_update,'declare @unload_reestr_cd int  select @unload_reestr_cd=ur.cd from journ.dbo.schet s inner join unload_reestr ur on ur.cd=s.reestr_code and ur.finish_date is null update unload_reestr set reestr_type=2 where cd =@unload_reestr_cd' as update_str,1 as need,'' as check_text,0 as group_teg 
union select 10051 as cd,136 as unload_file_id,36 as order_num,'COMENTP' as name,'Служебное поле' as description,null::int as unload_data_type_id,'' as length,'' as table_nm,'' as column_nm,null as column_type,'PERS' as db_table_nm, null as fl_update,'' as update_str,3 as need,'' as check_text,0 as group_teg 
    LOOP
       if (select count(*) from unload_data where unload_file_id=136 and name=ud.name and db_table_nm=ud.db_table_nm)=0 then
	insert into unload_data (id,unload_file_id,order_num,name,description,unload_data_type_id,length,table_nm,column_nm,unload_column_type_id,db_table_nm,fl_update,update_str,need,check_text,group_teg,fl_const,start_date)
	select ud.cd,ud.unload_file_id,ud.order_num,ud.name,ud.description,ud.unload_data_type_id,ud.length,ud.table_nm,ud.column_nm,ud.column_type,ud.db_table_nm,case when ud.fl_update is null then false else true end,ud.update_str,
	case when ud.need=1 then true when ud.need=3 then false else null end,ud.check_text,ud.group_teg,false,'05.05.2018';
       end if;
    END LOOP;

end
$$
